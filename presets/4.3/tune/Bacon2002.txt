#$ TITLE: Toothpick tune by Bacon
#$ FIRMWARE_VERSION: 4.3
#$ CATEGORY: TUNE
#$ STATUS: EXPERIMENTAL
#$ KEYWORDS: whoop, 65mm, 2S, race, acro, tune,
#$ AUTHOR: Bacon2002 - David H
#$ DISCUSSION: https://github.com/Bacon2002/Bacon2002-Presets-Live
#$ DESCRIPTION: 65mm whoop tune
#$ DESCRIPTION:
#$ DESCRIPTION: RPM filtering required
#$ DESCRIPTION: PLEASE REVIEW THE OPTIONS
#$ DESCRIPTION: Check ONE of the three FILTER options!
#$ DESCRIPTION:
#$ DESCRIPTION: The (recommended) options are what David uses, you should check all of them.
#$ DESCRIPTION: 
#$ DESCRIPTION:
#$ DESCRIPTION: These settings are applied by this Preset:
#$ DESCRIPTION: - Vbat Sag Compensation: 100%,
#$ DESCRIPTION: - VBat warning voltage: 3.5V
#$ DESCRIPTION: - DShot Idle: 6%
#$ DESCRIPTION: - Dynamic Idle: OFF
#$ DESCRIPTION: - Anti-Gravity: 45
#$ DESCRIPTION: - I-Term Relax: 20
#$ DESCRIPTION:
#$ DESCRIPTION: David's rates are included - give them a try!
#$ FORCE_OPTIONS_REVIEW: TRUE


#$ INCLUDE: presets/4.3/tune/defaults.txt

# -- PID values --
set p_pitch = 74
set i_pitch = 132
set d_pitch = 52
set d_min_pitch = 52
set f_pitch = 196

set p_roll = 67
set i_roll = 120
set d_roll = 40
set d_min_roll = 40
set f_roll = 180

set p_yaw = 67
set i_yaw = 120
set d_yaw = 0
set d_min_yaw = 0
set f_yaw = 180

# -- Sliders --
set simplified_pids_mode = RPY
set simplified_d_gain = 90
set simplified_pi_gain = 100
set simplified_feedforward_gain = 100
set simplified_dmax_gain = 0
set simplified_i_gain = 100
set simplified_pitch_d_gain = 115
set simplified_pitch_pi_gain = 105
set simplified_master_multiplier = 150

# -- iTerm relax --
set iterm_relax_cutoff = 20

# -- iTerm windup (default)--
# -- iTerm rotation (off, default) --

# -- Dmax --
# set d_max_advance = 20

# -- TPA --
set tpa_rate = 65
set tpa_breakpoint = 1350

# -- Feedforward --
# set feedforward_boost = 18
# set feedforward_max_rate_limit = 95
# set feedforward_jitter_factor = 5
# -- Feedforward averaging (do not change)--

# -- PIDsum limits (default)--

# -- Antigravity (default) --
# set anti_gravity_gain = 4500

# -- Absolute control (off, default) --
# -- Accecleration limits (off, default) --
# -- Angle and Horizon mode tuning (default) --
# -- PIDs active below min throttle (default) --
# -- Set mixer type to default (legacy) --
# -- Set yaw spin recovery to default, which is auto --
# -- Set integrated yaw to off, so pitch and yaw are independent (default) --
# -- Gyro cal on first arm (off, default) --
# -- Transient throttle limit (off, default) --
# -- Throttle limit (off, default) --
# -- Thrust linear (off, default) --
# -- Throttle boost (on, at default = 5)

# -- DShot Idle --
# set dshot_idle_value = 600


# ------ UN-CHECKED OPTIONS ------

# -- Filters --

#$ OPTION_GROUP BEGIN: Filters

# Filter options
#$ OPTION BEGIN (UNCHECKED): FILTER: RPM enabled, clean build
#$ INCLUDE: presets/4.3/filters/default_rpm_clean.txt
# set dyn_idle_min_rpm = 50
#$ OPTION END

#$ OPTION BEGIN (UNCHECKED): FILTER: RPM enabled, normal build
#$ INCLUDE: presets/4.3/filters/default_rpm_normal.txt
# set dyn_idle_min_rpm = 50
#$ OPTION END

#$ OPTION BEGIN (UNCHECKED): FILTER: RPM enabled, noisy build
#$ INCLUDE: presets/4.3/filters/default_rpm_noisy.txt
# set dyn_idle_min_rpm = 50
#$ OPTION END

#$ OPTION BEGIN (UNCHECKED): FILTER: NON-RPM ESCs, normal build
#$ INCLUDE: presets/4.3/filters/default_no_rpm_normal.txt
#$ OPTION END

#$ OPTION_GROUP END

# -- Fast Rx Link Options --

#$ OPTION_GROUP BEGIN: RC Links


#$ OPTION BEGIN (UNCHECKED): RC_LINK 250Hz
#set feedforward_averaging = 2_POINT
#set feedforward_smooth_factor = 40
#set feedforward_jitter_factor = 5
#$ OPTION END

#$ OPTION BEGIN (UNCHECKED): RC_LINK 500Hz
#set feedforward_averaging = 2_POINT
#set feedforward_smooth_factor = 65
#set feedforward_jitter_factor = 4
#$ OPTION END

#$ OPTION_GROUP END

#$ OPTION_GROUP BEGIN: Tune

#$ OPTION BEGIN (UNCHECKED): Bacon tune
# -- PID values --
set p_pitch = 74
set i_pitch = 132
set d_pitch = 52
set d_min_pitch = 52
set f_pitch = 196

set p_roll = 67
set i_roll = 120
set d_roll = 40
set d_min_roll = 40
set f_roll = 180

set p_yaw = 67
set i_yaw = 120
set d_yaw = 0
set d_min_yaw = 0
set f_yaw = 180

# -- Sliders --
set simplified_pids_mode = RPY
set simplified_d_gain = 90
set simplified_pi_gain = 100
set simplified_feedforward_gain = 100
set simplified_dmax_gain = 0
set simplified_i_gain = 100
set simplified_pitch_d_gain = 115
set simplified_pitch_pi_gain = 105
set simplified_master_multiplier = 150
#$ OPTION END

#$ OPTION BEGIN (UNCHECKED): Normal tune (normal builds)
# do nothing, it's already applied
#$ OPTION END

#$ OPTION BEGIN (UNCHECKED): Safer tune (older builds)
# -- PID values --
set p_pitch = 65
set i_pitch = 58
set d_pitch = 61
set d_min_pitch = 61
set f_pitch = 237

set p_roll = 63
set i_roll = 56
set d_roll = 57
set d_min_roll = 57
set f_roll = 228

set p_yaw = 63
set i_yaw = 56
set d_yaw = 0
set d_min_yaw = 0
set f_yaw = 228

# -- Sliders --
set simplified_pids_mode = RPY
set simplified_d_gain = 190
set simplified_pi_gain = 140
set simplified_feedforward_gain = 190
set simplified_dmax_gain = 0
set simplified_i_gain = 50
set simplified_pitch_d_gain = 95
set simplified_pitch_pi_gain = 100
set simplified_master_multiplier = 100
#$ OPTION END

#$ OPTION_GROUP END

# -- RC_Smoothing --
#$ OPTION BEGIN (UNCHECKED): Default RC_smoothing (recommended)
#$ INCLUDE: presets/4.3/rc_smoothing/race.txt
#$ OPTION END

# -- VBat warning threshold --
#$ OPTION BEGIN (UNCHECKED): Default warning voltage (recommended)
set vbat_warning_cell_voltage = 350
#$ OPTION END

# -- No deadband --
#$ OPTION BEGIN (UNCHECKED): No deadband (recommended)
set deadband = 0
set yaw_deadband = 0
#$ OPTION END

# -- Startup and arming --
#$ OPTION BEGIN (UNCHECKED): Arm at any angle (recommended)
set small_angle = 180
#$ OPTION END

# -- VBat sag compensation --
set vbat_sag_compensation = 100
set vbat_sag_lpf_period = 2
#$ OPTION BEGIN (UNCHECKED): 50% Sag compensation (optional)
set vbat_sag_compensation = 50
#$ OPTION END

# -- Throttle curve --
#$ OPTION BEGIN (UNCHECKED): Sharper throttle response curve (optional)
set thr_mid = 100
set thr_expo = 30
#$ OPTION END

# -- Dynamic idle --
set dyn_idle_min_rpm = 0
#$ OPTION BEGIN (UNCHECKED): Enable dynamic idle at 40 (optional)
set dyn_idle_min_rpm = 40
#$ OPTION END

# -- Rates --
#$ OPTION BEGIN (UNCHECKED): Try Gary's race rates! (go on!)
set thr_mid = 40
set thr_expo = 0
set rates_type = ACTUAL
set quickrates_rc_expo = OFF
set roll_rc_rate = 20
set pitch_rc_rate = 20
set yaw_rc_rate = 20
set roll_expo = 25
set pitch_expo = 25
set yaw_expo = 20
set roll_srate = 105
set pitch_srate = 105
set yaw_srate = 105
set tpa_rate = 65
set tpa_breakpoint = 1350
set tpa_mode = D
set throttle_limit_type = OFF
set throttle_limit_percent = 100
set roll_rate_limit = 1998
set pitch_rate_limit = 1998
set yaw_rate_limit = 1998
set roll_level_expo = 0
set pitch_level_expo = 0
#$ OPTION END
